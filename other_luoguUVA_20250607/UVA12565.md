# UVA12565 可爱的魔法曲线 Lovely Magical Curves

## 题目描述

[NURBS 曲线](http://geometrie.foretnik.net/files/NURBS-en.swf)由一系列参数点定义，它的函数如下：

$$C(u)=\dfrac{\sum_{i=1}^nw_iN_{i,k}(u)P_i}{\sum_{i=1}^nw_iN_{i,k}(u)}$$

而 $u$ 是参数，$n$ 是控制点的个数，$k$ 是曲线的度数，$P_i$ 是控制点的位置，$w_i$ 是控制点的权重。

$N_{i,k}$ 这样递归的定义：

$$N_{i,k}(u)=\frac{u-t_i}{t_{i+k}-t_i}N_{i,k-1}(u)+\frac{t_{i+k+1}-u}{t_{i+k+1}-t_{i+1}}N_{i+1,k-1}(u)$$

$$N_{i,0}(u)=[t_i\le u<t_{i+1}]$$

而 $t_i$ 是第 $i$ 个节。**在本题中 $\mathbf{0/0=0}$**。

为解释如上的恐怖公式，下面我们解释如上的参数。

+ **度数。** 度数 $k$ 是一个正整数。在 NURBS 中，直线的度数是 $1$，圆的是 $2$，有趣的曲线是 $3$ 或者 $5$。
+ **控制点。** 控制点至少有 $k+1$ 个。改变 NURBS 曲线的最简方式是移动控制点。任何一个控制点都有一个权重 $w_i$，在本题中权重是正整数。如果一个点的权重更大，则曲线被“吸”像该控制点。
+ **节。** 节向量的定义是 $U=[t_1,t_2,\cdots,t_m]$。$m,k,n$ 的关系是 $m=n+k+1$。节向量的相邻两项元素都满足 $t_i\le t_{i+1}$。每一组相邻的节代表一个参数值区间 $[t_i,t_{i+1})$ 用以计算曲线的形状。**因此，曲线的定义域是 $\mathbf{[t_1,t_m)}$。** 节值的重复次数是其倍率，且小于度数。节值的重复次数会减小曲线的平滑度。

如果你还是没有看懂，我们这里建议把 $u$ 从 $t_1$ 到 $t_m$ 移动（但不要等于 $t_m$），你就会看到 $C(u)$ 按照曲线所在的位置移动。

你的任务：求出两条 NURBS 曲线的交点。

## 输入格式

$T$ 组数据。

每组数据包含两部分，分别描述两条 NURBS 曲线。每条曲线的开头是两个整数 $n,m(2\le n\le 20)$，而后 $n$ 行每行三个实数 $x,y,w(0\le x,y\le 10,0<w\le 10)$ 代表控制点 $P_i(x,y),w_i$。而后一行是 $m$ 个实数，即节向量。第一个节值永远是 $0$ 并且最后一个永远是 $1$。度数永远是 $1,2,3,5$ 中之一。

## 输出格式

第一行一个数即交点个数。各个交点应四舍五入到小数点后三位，并且每个点应按照字典序排列（即从小到大，先 $x$ 后 $y$）。输入是专门设计的，以满足最小的交点的 $x$ 坐标只差最少为 $0.005$。

对于每组数据，在末尾输出一个空行。

## 输入输出样例 #1

### 输入 #1

```
2
8 12
2 01
0 11
1 32
1.5 2 1
2.5 2 1
3 32
4 11
2 01
0 0 0 0 0.2 0.4 0.6 0.8 1 1 1 1
2 4
0 0 1
4 3 1
0 0 1 1
7 10
1 1.732 1
0 0 0.5
2 0 1
4 0 0.5
3 1.732 1
2 3.464 0.5
1 1.732 1
0 0 0 0.333 0.333 0.667 0.667 1 1 1
7 10
0 1.732 1
2 0 0.5
3 0 1
6 0 0.5
2 1.732 1
6 3.464 0.5
0 1.732 1
0 0 0 0.333 0.333 0.667 0.667 1 1 1
```

### 输出 #1

```
Case 1: 2
(1.029, 0.772)
(3.221, 2.416)
Case 2: 6
(0.847, 1.092)
(1.307, 2.078)
(2.283, 2.274)
(2.538, 0.133)
(2.693, 2.078)
(3.153, 1.092)
```