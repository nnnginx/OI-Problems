<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js"></script>
<script>// <![CDATA[
document.addEventListener("DOMContentLoaded", function(){
  renderMathInElement(
    document.body,{
      delimiters: [
        {left: "$$", right: "$$", display: true},
        {left: "$", right: "$", display: false}]})});
// ]]></script>
<p style="box-sizing: border-box; margin: 0px 0px 10px; color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">This problem is a harder version of <a href="http://www.spoj.com/problems/MOON2/">MOON2</a>.</p>
<p style="box-sizing: border-box; margin: 0px 0px 10px; color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">Your task is: given $N$, $a$ and $r$, compute</p>
<p style="box-sizing: border-box; margin: 0px 0px 10px; color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">$$ S(N, a, r) = \sum_{i=1}^N a^i i^r. $$</p>
<ul>
</ul>
<h3>Input</h3>
<p><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">The first line contains an integer $T$</span><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">, the number of test cases.</span><br style="box-sizing: border-box; color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;"><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">On the next $T$</span><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">&nbsp;lines, you will be given three integers $N$</span><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">, $a$</span><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">&nbsp;and $r$</span><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">.</span></p>
<h3>Output</h3>
<p><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">Output $T$</span><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">&nbsp;lines, one for each test case, with $S(N, a, r)$.</span><br style="box-sizing: border-box; color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;"><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">Since the answer can get very big, output it modulo $10^9+7$</span><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">.</span></p>
<h3>Example</h3>
<pre><strong>Input:</strong>
2<br>3 4 5<br>6 7 8

<strong>Output:</strong>
16068<br>329990641</pre>
<h3>Constraints</h3>
<p><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">Overall constraints:</span></p>
<p><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;"><span style="box-sizing: border-box; font-weight: 700; color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;"> </span></span></p>
<li style="box-sizing: border-box;"><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">$1 \leq T \leq 10^5$</span></li>
<li style="box-sizing: border-box;"><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">$1 \leq N \leq 10^{18}$</span></li>
<li style="box-sizing: border-box;"><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">$1 \leq a \leq 10^{18}$</span></li>
<li style="box-sizing: border-box;"><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">$1 \leq r \leq 10^8$</span></li>
<p>&nbsp;</p>
<p><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">More precise information: there are 6 test cases.</span></p>
<p><span style="font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; color: #555555;"><span style="font-size: 14px;">Test #0: $1 \leq T \leq 100000$ and $1 \leq r \leq 1000$.</span></span></p>
<p><span style="font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; color: #555555;"><span style="font-size: 14px;">Test #1: <span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">$1 \leq T \leq 10000$ and $1 \leq r \leq 10000$.</span></span></span></p>
<p><span style="font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; color: #555555;"><span style="font-size: 14px;">Test #2: <span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">$1 \leq T \leq 1000$ and $1 \leq r \leq 100000$.</span></span></span></p>
<p><span style="font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; color: #555555;"><span style="font-size: 14px;">Test #3: <span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">$1 \leq T \leq 100$ and $1 \leq r \leq 1000000$.</span></span></span></p>
<p><span style="font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; color: #555555;"><span style="font-size: 14px;">Test #4: <span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">$1 \leq T \leq 10$ and $1 \leq r \leq 10000000$.</span></span></span></p>
<p><span style="font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; color: #555555;"><span style="font-size: 14px;">Test #5: <span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">$T = 1$ and $1 \leq r \leq 100000000$.</span></span></span></p>
<h3>Information</h3>
<p><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">Four trips on the moon are provided,&nbsp;</span><a style="font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px; background-color: transparent; box-sizing: border-box; color: #337ab7; text-decoration-line: none; transition: all 0.5s ease 0s; outline: none;" href="http://www.spoj.com/problems/MOON/">Moon</a><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">&nbsp;(easy),&nbsp;</span><a style="font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px; background-color: transparent; box-sizing: border-box; color: #337ab7; text-decoration-line: none; transition: all 0.5s ease 0s; outline: none;" href="http://www.spoj.com/problems/MOON1/">Moon1</a><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">&nbsp;(medium),&nbsp;</span><a style="font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px; background-color: transparent; box-sizing: border-box; color: #337ab7; text-decoration-line: none; transition: all 0.5s ease 0s; outline: none;" href="http://www.spoj.com/problems/MOON2/">Moon2</a><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">&nbsp;(hard),&nbsp;</span><a style="font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;" href="../MOON4/">Moon4</a><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">&nbsp;(extreme) with different constraints.</span></p>
<p><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">Please pay attention to the constraints which may differ from the previous versions.</span></p>
<p><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">Also please handle the constraints carefully.</span></p>
<p><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">We do not provide the intended time complexity in order to encourage possible various ways of thinking.&nbsp;</span></p>
<p><span style="font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; color: #555555;"><span style="font-size: 14px;">My fastest C++ code got AC under in 12.14s. (approx 2.02s per file)</span></span></p>
<p><span style="color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">Good luck and have fun :-)</span></p>
<p style="box-sizing: border-box; margin: 0px 0px 10px; color: #555555; font-family: &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-size: 14px;">You may be surprised why the code of this problem is not&nbsp;<a href="../MOON3/">Moon3</a>. It is because&nbsp;</p>
<ul>
<li>4 is a lucky number on the moon.&nbsp;</li>
<li>This problem is the 4th one in the Moon series.</li>
<li>4 is a power of 2, which indicates exponential increasing difficulty starting from 2.</li>
<li><span style="text-decoration: line-through;">Moon3 has been used.</span>&nbsp;</li>
</ul>
<p>&nbsp;</p>